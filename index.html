<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duyuru KaydÄ±</title>
    <!-- OneSignal v16 SDK (en gÃ¼ncel) -->
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
        // URL'den parametreleri al
        const urlParams = new URLSearchParams(window.location.search);
        const uid = urlParams.get('uid');          // KullanÄ±cÄ± adÄ± (external_user_id)
        const appId = urlParams.get('appid');      // OneSignal App ID
        const role = urlParams.get('role') || "Bilinmiyor";

        if (!uid || !appId) {
            document.body.innerHTML = '<h2 style="color:red; text-align:center; margin-top:100px;">GeÃ§ersiz kayÄ±t linki! LÃ¼tfen uygulamadan tekrar deneyin.</h2>';
            throw new Error("GeÃ§ersiz parametreler");
        }

        window.OneSignalDeferred = window.OneSignalDeferred || [];
        OneSignalDeferred.push(async function(OneSignal) {
            try {
                // OneSignal'Ä± baÅŸlat
                await OneSignal.init({
                    appId: appId,
                    allowLocalhostAsSecureOrigin: true, // Test iÃ§in (production'da kaldÄ±rÄ±labilir)
                    promptOptions: {
                        slidedown: {
                            enabled: true,
                            autoPrompt: true,
                            timeDelay: 0,           // Hemen Ã§Ä±ksÄ±n
                            pageViews: 1,
                            text: {
                                actionMessage: "Staj duyurularÄ± ve maaÅŸ bildirimlerini anlÄ±k almak ister misiniz?",
                                acceptButton: "Evet, Ä°zin Ver",
                                cancelButton: "HayÄ±r, TeÅŸekkÃ¼rler"
                            }
                        }
                    }
                });

                // KullanÄ±cÄ±yÄ± login et (external user ID)
                await OneSignal.login(uid);

                // Rol tag'ini ekle (sunucuda filtreleme iÃ§in Ã¶nemli)
                await OneSignal.User.addTag("role", role);

                // BaÅŸarÄ±lÄ± mesajÄ± gÃ¶ster
                setTimeout(() => {
                    document.body.innerHTML = `
                        <div style="text-align:center; margin-top:100px; color:#2ecc71;">
                            <h2>âœ… KayÄ±t BaÅŸarÄ±yla TamamlandÄ±!</h2>
                            <p>DuyurularÄ± ve maaÅŸ bildirimlerini alacaksÄ±nÄ±z.</p>
                            <p>Bu pencereyi kapatabilirsiniz.</p>
                        </div>`;
                }, 4000);

            } catch (e) {
                console.error("OneSignal hatasÄ±:", e);
                document.body.innerHTML = `<h2 style="color:red; text-align:center;">Hata: ${e.message}</h2>`;
            }
        });
    </script>
</head>
<body style="font-family:Arial, sans-serif; text-align:center; padding:50px; background:#f0f8ff;">
    <div style="background:white; padding:40px; border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,0.1); max-width:500px; margin:0 auto;">
        <h2 style="color:#2ecc71;">ğŸ”” Bildirim KaydÄ± YapÄ±lÄ±yor...</h2>
        <p style="font-size:1.2em; margin:30px 0;">LÃ¼tfen Ã§Ä±kan <b>"Ä°zin Ver"</b> kutusuna basÄ±n.</p>
        <p><small>Otomatik kapanmazsa bu pencereyi kapatabilirsiniz.</small></p>
    </div>
</body>
</html>
